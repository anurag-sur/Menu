<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Food Menu</title>

  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin:0;
      overflow:hidden;
      font-family:'Inter',system-ui,sans-serif;
      background:black;
    }

    .btn {
      position:absolute;
      bottom:20px;
      padding:12px 18px;
      background:rgba(0,0,0,0.85);
      color:white;
      border:none;
      border-radius:14px;
      font-size:16px;
      font-weight:500;
      z-index:999;
      cursor:pointer;
      transition:transform .08s ease, background .08s ease;
    }

    .btn:active {
      transform:scale(.92);
      background:rgba(255,255,255,.15);
    }

    #left{left:15px}
    #right{right:15px}
    #rate{left:50%;transform:translateX(-50%)}

    #info {
      position:absolute;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,.75);
      color:white;
      padding:10px 18px;
      border-radius:16px;
      font-size:16px;
      font-weight:500;
      z-index:999;
    }

    #loading {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:rgba(0,0,0,.75);
      color:white;
      padding:14px 22px;
      border-radius:18px;
      font-size:16px;
      font-weight:600;
      display:none;
      z-index:1000;
    }

    #ratingMenu {
      position:absolute;
      bottom:90px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,.85);
      padding:12px 18px;
      border-radius:18px;
      display:none;
      z-index:1000;
    }

    .star {
      font-size:26px;
      color:#777;
      cursor:pointer;
      transition:transform .08s ease, color .08s ease;
    }

    .star:active { transform:scale(.9); }
    .star.active { color:#FFD700; }

    #toast {
      position:absolute;
      bottom:150px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,.85);
      color:white;
      padding:10px 18px;
      border-radius:16px;
      font-size:15px;
      font-weight:500;
      opacity:0;
      transition:opacity .3s ease;
      z-index:1000;
    }
  </style>
</head>

<body>

<div id="info">Burger • ₹149</div>
<div id="loading">Loading model…</div>
<div id="toast"></div>

<button id="left" class="btn">◀</button>
<button id="rate" class="btn">Rate</button>
<button id="right" class="btn">▶</button>

<div id="ratingMenu">
  <span class="star" data-star="1">★</span>
  <span class="star" data-star="2">★</span>
  <span class="star" data-star="3">★</span>
  <span class="star" data-star="4">★</span>
  <span class="star" data-star="5">★</span>
</div>

<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">

  <a-entity light="type:ambient;intensity:.8"></a-entity>
  <a-entity light="type:directional;intensity:.4" position="1 2 1"></a-entity>

  <a-entity camera></a-entity>
  <a-entity id="holder" position="0 0 -4"></a-entity>

</a-scene>

<script>
window.addEventListener("load",()=>{

const foods=[
 {model:"models/burger/scene.gltf",name:"Burger",price:"₹149",scale:.4},
 {model:"models/pizza/scene.gltf", name:"Pizza", price:"₹299",scale:2},
 {model:"models/fries/scene.gltf", name:"Fries", price:"₹99", scale:.5}
];

const holder=document.getElementById("holder");
const info=document.getElementById("info");
const ratingMenu=document.getElementById("ratingMenu");
const loading=document.getElementById("loading");
const toast=document.getElementById("toast");

let index=0;
let model=document.createElement("a-entity");
holder.appendChild(model);

let scale,yaw=0,pitch=0,autoRotate=true;

function showToast(t){
 toast.innerText=t;
 toast.style.opacity=1;
 setTimeout(()=>toast.style.opacity=0,1800);
}

function loadFood(i){
 loading.style.display="block";
 model.setAttribute("gltf-model",foods[i].model);
 scale=foods[i].scale;
 model.object3D.scale.set(scale,scale,scale);
 yaw=pitch=0;
 info.innerText=`${foods[i].name} • ${foods[i].price}`;
}

model.addEventListener("model-loaded",()=>loading.style.display="none");
loadFood(0);

/* NAV */
left.onclick=()=>{index=(index-1+foods.length)%foods.length;loadFood(index)};
right.onclick=()=>{index=(index+1)%foods.length;loadFood(index)};

/* RATE TOGGLE */
rate.onclick=()=>{
 ratingMenu.style.display =
   ratingMenu.style.display==="block" ? "none" : "block";
};

/* STARS (STAYS OPEN) */
document.querySelectorAll(".star").forEach(star=>{
 star.onclick=()=>{
  const r=star.dataset.star;
  document.querySelectorAll(".star").forEach(s=>{
   s.classList.toggle("active",s.dataset.star<=r);
  });
  showToast(`You rated ${r} star${r>1?"s":""}`);
 };
});

/* TOUCH CONTROLS */
let dragging=false,lastX=0,lastY=0,zoomStart=0;

function pinch(t){
 const dx=t[0].clientX-t[1].clientX;
 const dy=t[0].clientY-t[1].clientY;
 return Math.hypot(dx,dy);
}

document.addEventListener("touchstart",e=>{
 autoRotate=false;
 if(e.touches.length===1){
  dragging=true;
  lastX=e.touches[0].clientX;
  lastY=e.touches[0].clientY;
 }
 if(e.touches.length===2) zoomStart=pinch(e.touches);
});

document.addEventListener("touchmove",e=>{
 if(e.touches.length===2){
  const d=pinch(e.touches);
  scale*=d/zoomStart;
  scale=Math.min(2.5,Math.max(.2,scale));
  model.object3D.scale.set(scale,scale,scale);
  zoomStart=d;
  return;
 }
 if(dragging){
  yaw+=(e.touches[0].clientX-lastX)*.01;
  pitch+=(e.touches[0].clientY-lastY)*.01;
  lastX=e.touches[0].clientX;
  lastY=e.touches[0].clientY;
  model.object3D.rotation.set(pitch,yaw,0);
 }
});

document.addEventListener("touchend",()=>{
 dragging=false;
 setTimeout(()=>autoRotate=true,3000);
});

/* AUTO ROTATE */
AFRAME.registerComponent("spin",{tick:()=>{
 if(autoRotate){
  yaw+=.003;
  model.object3D.rotation.y=yaw;
 }
}});
model.setAttribute("spin","");

});
</script>

</body>
</html>
