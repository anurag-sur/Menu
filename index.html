<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>3D Food Menu</title>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }

body {
 margin: 0;
 overflow: hidden;
 font-family: 'Inter', sans-serif;
 background: #0b0b0c;
 color: white;
}

#topBar {
 position: absolute;
 top: 0;
 left: 0;
 right: 0;
 padding: 20px;
 background: linear-gradient(180deg, rgba(0,0,0,.6) 0%, transparent 100%);
 z-index: 5;
 display: flex;
 justify-content: space-between;
 align-items: center;
}

#logo {
 font-size: 20px;
 font-weight: 700;
 letter-spacing: -0.5px;
}

#cartBtn {
 width: 44px;
 height: 44px;
 background: rgba(30,30,32,.85);
 border: 1px solid rgba(255,255,255,.1);
 border-radius: 50%;
 color: white;
 font-size: 20px;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 position: relative;
 transition: transform .15s;
}

#cartBtn:active {
 transform: scale(.95);
}

#cartBadge {
 position: absolute;
 top: -4px;
 right: -4px;
 background: #ff3b30;
 color: white;
 border-radius: 10px;
 padding: 2px 6px;
 font-size: 11px;
 font-weight: 700;
 min-width: 18px;
 text-align: center;
 display: none;
}

#infoCard {
 position: absolute;
 top: 80px;
 left: 50%;
 transform: translateX(-50%);
 width: 90%;
 max-width: 320px;
 padding: 16px 20px;
 background: rgba(20,20,22,.92);
 backdrop-filter: blur(20px);
 border-radius: 16px;
 border: 1px solid rgba(255,255,255,.08);
 z-index: 5;
 text-align: center;
}

#foodName {
 font-size: 22px;
 font-weight: 700;
 margin-bottom: 6px;
}

#foodPrice {
 font-size: 20px;
 font-weight: 700;
 color: #4CAF50;
}

#controls {
 position: absolute;
 bottom: 0;
 left: 0;
 right: 0;
 padding: 24px;
 background: linear-gradient(0deg, rgba(0,0,0,.7) 0%, transparent 100%);
 z-index: 5;
}

#navButtons {
 display: flex;
 gap: 16px;
 justify-content: center;
 align-items: center;
}

.nav-btn {
 width: 56px;
 height: 56px;
 background: rgba(30,30,32,.9);
 border: 1px solid rgba(255,255,255,.12);
 color: white;
 border-radius: 50%;
 font-size: 24px;
 cursor: pointer;
 transition: all .15s;
 display: flex;
 align-items: center;
 justify-content: center;
}

.nav-btn:active {
 transform: scale(.94);
 background: rgba(50,50,55,.95);
}

#addCart {
 flex: 1;
 max-width: 200px;
 height: 56px;
 background: linear-gradient(135deg, #1f7aff 0%, #0066ff 100%);
 border: none;
 border-radius: 16px;
 color: white;
 font-weight: 700;
 font-size: 16px;
 cursor: pointer;
 box-shadow: 0 4px 20px rgba(31,122,255,.4);
 transition: transform .15s;
}

#addCart:active {
 transform: scale(.96);
}

#cartModal {
 position: absolute;
 inset: 0;
 background: rgba(0,0,0,.85);
 backdrop-filter: blur(10px);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 100;
}

#cartContent {
 background: rgba(20,20,22,.98);
 border-radius: 24px;
 padding: 28px 24px;
 width: 90%;
 max-width: 420px;
 max-height: 80vh;
 overflow-y: auto;
 border: 1px solid rgba(255,255,255,.1);
}

#cartHeader {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 20px;
}

#cartHeader h2 {
 margin: 0;
 font-size: 24px;
 font-weight: 700;
}

.cart-item {
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 14px;
 background: rgba(40,40,45,.6);
 border-radius: 14px;
 margin-bottom: 12px;
}

.cart-item-info {
 flex: 1;
}

.cart-item-name {
 font-weight: 600;
 font-size: 15px;
 margin-bottom: 4px;
}

.cart-item-price {
 color: rgba(255,255,255,.5);
 font-size: 13px;
}

.cart-item-controls {
 display: flex;
 align-items: center;
 gap: 12px;
}

.qty-btn {
 width: 32px;
 height: 32px;
 border-radius: 10px;
 background: rgba(60,60,65,.8);
 border: 1px solid rgba(255,255,255,.1);
 color: white;
 font-size: 18px;
 cursor: pointer;
 display: flex;
 align-items: center;
 justify-content: center;
 font-weight: 600;
}

.qty {
 font-weight: 700;
 min-width: 28px;
 text-align: center;
}

#cartTotal {
 margin-top: 20px;
 padding-top: 20px;
 border-top: 1px solid rgba(255,255,255,.1);
 display: flex;
 justify-content: space-between;
 align-items: center;
 font-size: 20px;
 font-weight: 700;
}

#totalPrice {
 color: #4CAF50;
}

.cart-actions {
 display: flex;
 gap: 12px;
 margin-top: 20px;
}

.cart-actions button {
 flex: 1;
 padding: 14px;
 border-radius: 14px;
 border: none;
 font-size: 16px;
 font-weight: 700;
 cursor: pointer;
 font-family: inherit;
}

#closeCart {
 background: rgba(60,60,65,.8);
 color: white;
 border: 1px solid rgba(255,255,255,.1);
}

#checkout {
 background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
 color: white;
}

#checkout:disabled {
 background: rgba(60,60,65,.5);
 cursor: not-allowed;
}

#emptyCart {
 text-align: center;
 padding: 40px;
 color: rgba(255,255,255,.4);
}

#toast {
 position: absolute;
 top: 90px;
 left: 50%;
 transform: translateX(-50%);
 background: rgba(31,122,255,.95);
 padding: 12px 20px;
 border-radius: 12px;
 font-size: 14px;
 font-weight: 600;
 opacity: 0;
 transition: opacity .3s;
 z-index: 101;
 pointer-events: none;
}

#loading {
 position: absolute;
 inset: 0;
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 background: #0b0b0c;
 z-index: 102;
 gap: 16px;
}

#loadingText {
 font-size: 18px;
 font-weight: 600;
}

#loadingBar {
 width: 200px;
 height: 4px;
 background: rgba(255,255,255,.1);
 border-radius: 2px;
 overflow: hidden;
}

#loadingProgress {
 height: 100%;
 background: linear-gradient(90deg, #1f7aff, #0066ff);
 width: 0%;
 transition: width .3s;
}

a-scene {
 width: 100vw;
 height: 100vh;
}
</style>
</head>
<body>

<div id="topBar">
 <div id="logo">üçî FoodAR</div>
 <button id="cartBtn">üõí<span id="cartBadge">0</span></button>
</div>

<div id="infoCard">
 <div id="foodName"></div>
 <div id="foodPrice"></div>
</div>

<div id="loading">
 <div id="loadingText">Loading models‚Ä¶ 0/9</div>
 <div id="loadingBar">
   <div id="loadingProgress"></div>
 </div>
</div>

<div id="toast"></div>

<div id="controls">
 <div id="navButtons">
   <button class="nav-btn" id="left">‚Äπ</button>
   <button id="addCart">Add to Cart</button>
   <button class="nav-btn" id="right">‚Ä∫</button>
 </div>
</div>

<div id="cartModal">
 <div id="cartContent">
   <div id="cartHeader">
     <h2>Your Cart</h2>
     <span id="itemCount" style="color:rgba(255,255,255,.5);font-size:14px;"></span>
   </div>
   <div id="cartItems"></div>
   <div id="emptyCart" style="display:none;">Your cart is empty üõí</div>
   <div id="cartTotal" style="display:none;">
     <span>Total:</span>
     <span id="totalPrice">‚Çπ0</span>
   </div>
   <div class="cart-actions">
     <button id="closeCart">Close</button>
     <button id="checkout">Checkout</button>
   </div>
 </div>
</div>

<a-scene background="color: #0b0b0c" vr-mode-ui="enabled: false">
 <a-entity light="type: ambient; intensity: 0.6"></a-entity>
 <a-entity light="type: directional; intensity: 0.8; castShadow: true" position="2 4 2"></a-entity>
 
 <a-entity position="0 1.6 4">
   <a-camera look-controls="enabled: false" wasd-controls="enabled: false"></a-camera>
 </a-entity>
 
 <a-entity id="holder" position="0 0 -2"></a-entity>
 <a-plane position="0 -1 -2" rotation="-90 0 0" width="10" height="10" color="#1a1a1a" opacity="0.5"></a-plane>
</a-scene>

<script>
const foods = [
 {model:"models/burger/scene.gltf", name:"Burger", price:149, scale:.4},
 {model:"models/pizza/scene.gltf", name:"Pizza", price:299, scale:2},
 {model:"models/fries/scene.gltf", name:"Fries", price:99, scale:.5},
 {model:"models/assorted_salad/scene.gltf", name:"Salad", price:129, scale:6},
 {model:"models/chole_bhature/scene.gltf", name:"Chole Bhature", price:89, scale:6},
 {model:"models/grilled_sandwich/scene.gltf", name:"Sandwich", price:49, scale:6},
 {model:"models/palak_paneer/scene.gltf", name:"Palak Paneer", price:79, scale:6},
 {model:"models/samosa/scene.gltf", name:"Samosa", price:39, scale:.5}
];

const holder = document.getElementById("holder");
const foodName = document.getElementById("foodName");
const foodPrice = document.getElementById("foodPrice");
const loading = document.getElementById("loading");
const loadingText = document.getElementById("loadingText");
const loadingProgress = document.getElementById("loadingProgress");
const toast = document.getElementById("toast");
const cartModal = document.getElementById("cartModal");
const cartItems = document.getElementById("cartItems");
const cartBadge = document.getElementById("cartBadge");
const totalPrice = document.getElementById("totalPrice");
const emptyCart = document.getElementById("emptyCart");
const cartTotal = document.getElementById("cartTotal");
const itemCount = document.getElementById("itemCount");

let index = 0;
let cart = [];
let models = [];
let loadedCount = 0;
let autoRotate = true;
let currentScale = 1;

function showToast(t) {
 toast.textContent = t;
 toast.style.opacity = 1;
 setTimeout(() => toast.style.opacity = 0, 2000);
}

function updateCartBadge() {
 const total = cart.reduce((sum, item) => sum + item.qty, 0);
 cartBadge.textContent = total;
 cartBadge.style.display = total > 0 ? "block" : "none";
}

function updateCartDisplay() {
 if (cart.length === 0) {
   cartItems.innerHTML = "";
   emptyCart.style.display = "block";
   cartTotal.style.display = "none";
   document.getElementById("checkout").disabled = true;
   itemCount.textContent = "";
   return;
 }

 const total = cart.reduce((sum, item) => sum + item.qty, 0);
 itemCount.textContent = `${total} item${total > 1 ? 's' : ''}`;
 emptyCart.style.display = "none";
 cartTotal.style.display = "flex";
 document.getElementById("checkout").disabled = false;

 cartItems.innerHTML = cart.map((item, idx) => `
   <div class="cart-item">
     <div class="cart-item-info">
       <div class="cart-item-name">${item.name}</div>
       <div class="cart-item-price">‚Çπ${item.price} each</div>
     </div>
     <div class="cart-item-controls">
       <button class="qty-btn" onclick="changeQty(${idx}, -1)">‚àí</button>
       <span class="qty">${item.qty}</span>
       <button class="qty-btn" onclick="changeQty(${idx}, 1)">+</button>
     </div>
   </div>
 `).join("");

 totalPrice.textContent = `‚Çπ${cart.reduce((sum, item) => sum + (item.price * item.qty), 0)}`;
}

window.changeQty = function(idx, delta) {
 cart[idx].qty += delta;
 if (cart[idx].qty <= 0) cart.splice(idx, 1);
 updateCartBadge();
 updateCartDisplay();
};

function showFood(i) {
 models.forEach((m, idx) => m.object3D.visible = (idx === i));
 if (models[i]) {
   currentScale = foods[i].scale;
   models[i].object3D.scale.set(currentScale, currentScale, currentScale);
   models[i].object3D.rotation.set(0, 0, 0);
 }
 
 foodName.textContent = foods[i].name;
 foodPrice.textContent = `‚Çπ${foods[i].price}`;
};

foods.forEach((food, i) => {
 const m = document.createElement("a-entity");
 m.setAttribute("gltf-model", food.model);
 m.object3D.scale.set(food.scale, food.scale, food.scale);
 m.object3D.visible = false;
 holder.appendChild(m);
 models.push(m);

 m.addEventListener("model-loaded", () => {
   loadedCount++;
   const progress = (loadedCount / foods.length) * 100;
   loadingProgress.style.width = progress + "%";
   loadingText.textContent = `Loading models‚Ä¶ ${loadedCount}/${foods.length}`;
   
   if (loadedCount === foods.length) {
     setTimeout(() => {
       loading.style.display = "none";
       showFood(0);
     }, 300);
   }
 });
 
 m.addEventListener("model-error", () => {
   loadedCount++;
   const progress = (loadedCount / foods.length) * 100;
   loadingProgress.style.width = progress + "%";
   loadingText.textContent = `Loading models‚Ä¶ ${loadedCount}/${foods.length}`;
   if (loadedCount === foods.length) {
     loading.style.display = "none";
     showFood(0);
   }
 });
});

document.getElementById("left").onclick = () => {
 index = (index + foods.length - 1) % foods.length;
 showFood(index);
};

document.getElementById("right").onclick = () => {
 index = (index + 1) % foods.length;
 showFood(index);
};

document.getElementById("cartBtn").onclick = () => {
 updateCartDisplay();
 cartModal.style.display = "flex";
};

document.getElementById("closeCart").onclick = () => {
 cartModal.style.display = "none";
};

document.getElementById("checkout").onclick = () => {
 if (cart.length === 0) return;
 const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
 showToast(`Order placed: ‚Çπ${total} ‚úÖ`);
 cart = [];
 updateCartBadge();
 updateCartDisplay();
 setTimeout(() => cartModal.style.display = "none", 1000);
};

document.getElementById("addCart").onclick = () => {
 const food = foods[index];
 const existing = cart.find(item => item.name === food.name);
 if (existing) {
   existing.qty++;
 } else {
   cart.push({name: food.name, price: food.price, qty: 1});
 }
 updateCartBadge();
 showToast(`${food.name} added! üõí`);
};

cartModal.onclick = (e) => {
 if (e.target === cartModal) cartModal.style.display = "none";
};

// Touch/Mouse rotation
let dragging = false, lx = 0, ly = 0;

document.addEventListener("mousedown", e => {
 if (e.target.closest("#controls") || e.target.closest("#topBar") || e.target.closest("#cartModal")) return;
 dragging = true;
 lx = e.clientX;
 ly = e.clientY;
 autoRotate = false;
});

document.addEventListener("mousemove", e => {
 if (!dragging || !models[index]) return;
 const dx = (e.clientX - lx) * 0.01;
 models[index].object3D.rotation.y += dx;
 lx = e.clientX;
});

document.addEventListener("mouseup", () => {
 dragging = false;
 setTimeout(() => autoRotate = true, 2000);
});

// Zoom functionality - Mouse wheel
document.addEventListener("wheel", e => {
 if (e.target.closest("#controls") || e.target.closest("#topBar") || e.target.closest("#cartModal")) return;
 if (!models[index]) return;
 
 e.preventDefault();
 const delta = e.deltaY * -0.001;
 currentScale = Math.max(0.1, Math.min(10, currentScale + delta));
 models[index].object3D.scale.set(currentScale, currentScale, currentScale);
}, { passive: false });

// Zoom functionality - Touch pinch
let initialPinchDistance = null;
let initialScale = 1;

document.addEventListener("touchstart", e => {
 if (e.touches.length === 2) {
   initialPinchDistance = Math.hypot(
     e.touches[0].clientX - e.touches[1].clientX,
     e.touches[0].clientY - e.touches[1].clientY
   );
   initialScale = currentScale;
 }
});

document.addEventListener("touchmove", e => {
 if (e.touches.length === 2 && models[index]) {
   e.preventDefault();
   const distance = Math.hypot(
     e.touches[0].clientX - e.touches[1].clientX,
     e.touches[0].clientY - e.touches[1].clientY
   );
   const delta = distance / initialPinchDistance;
   currentScale = Math.max(0.1, Math.min(10, initialScale * delta));
   models[index].object3D.scale.set(currentScale, currentScale, currentScale);
 }
});

// Auto-rotate animation
function animate() {
 if (autoRotate && models[index]) {
   models[index].object3D.rotation.y += 0.005;
 }
 requestAnimationFrame(animate);
}
animate();

// Safety timeout
setTimeout(() => {
 if (loading.style.display !== "none") {
   loading.style.display = "none";
   showFood(0);
 }
}, 10000);
</script>

</body>
</html>
