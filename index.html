<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AR Food Menu</title>

<!-- DO NOT CHANGE (LOCKED VERSIONS) -->
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0b0b0c;
  color:white;
}

/* ---------- Top Info ---------- */
#info{
  position:absolute;
  top:18px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 20px;
  background:rgba(25,25,30,.75);
  backdrop-filter:blur(12px);
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  z-index:5;
  transition:opacity .2s, transform .2s;
}

/* ---------- Buttons ---------- */
.btn{
  position:absolute;
  bottom:18px;
  padding:12px 20px;
  background:linear-gradient(145deg,rgba(50,50,60,.9),rgba(25,25,30,.9));
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  transition:transform .1s;
}
.btn:active{ transform:scale(.96); }

#left{ left:14px; }
#right{ right:14px; }
#rate{ left:50%; transform:translateX(-50%); }

/* ---------- Rating ---------- */
#ratingMenu{
  position:absolute;
  bottom:76px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 18px;
  background:rgba(25,25,30,.85);
  backdrop-filter:blur(12px);
  border-radius:18px;
  display:none;
  z-index:5;
}

.star{
  font-size:28px;
  cursor:pointer;
  color:rgba(255,255,255,.25);
  transition:color .15s, transform .1s;
}
.star.active{ color:#FFD54F; }
.star:active{ transform:scale(1.25); }

/* ---------- Toast ---------- */
#toast{
  position:absolute;
  top:70px;
  left:50%;
  transform:translateX(-50%);
  background:#1f7aff;
  padding:8px 14px;
  border-radius:14px;
  font-size:14px;
  opacity:0;
  transition:opacity .3s;
  z-index:6;
}

/* ---------- Loading ---------- */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0b0b0c;
  z-index:10;
  font-size:18px;
  font-weight:600;
}

a-scene{ pointer-events:none; }
#info,#toast,.btn,#ratingMenu,.star{ pointer-events:auto; }
</style>
</head>

<body>

<div id="info"></div>
<div id="toast"></div>
<div id="loading">Loading model…</div>

<button id="left" class="btn">◀</button>
<button id="rate" class="btn">Rate</button>
<button id="right" class="btn">▶</button>

<div id="ratingMenu">
  <span class="star" data-s="1">★</span>
  <span class="star" data-s="2">★</span>
  <span class="star" data-s="3">★</span>
  <span class="star" data-s="4">★</span>
  <span class="star" data-s="5">★</span>
</div>

<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">

  <a-assets>
    <a-asset-item id="burger" src="models/burger/scene.gltf"></a-asset-item>
    <a-asset-item id="pizza" src="models/pizza/scene.gltf"></a-asset-item>
    <a-asset-item id="fries" src="models/fries/scene.gltf"></a-asset-item>
  </a-assets>

  <a-entity light="type:ambient; intensity:0.9"></a-entity>
  <a-entity light="type:directional; intensity:0.5" position="1 2 1"></a-entity>

  <a-entity camera></a-entity>

  <a-entity id="holder" position="0 0 -4">
    <!-- Fake table shadow -->
    <a-plane rotation="-90 0 0"
             width="2"
             height="2"
             color="#000"
             opacity="0.25"
             position="0 -0.01 0">
    </a-plane>
  </a-entity>

</a-scene>

<script>
const foods=[
 {model:"#burger",name:"Burger",price:"₹149",scale:.4},
 {model:"#pizza",name:"Pizza",price:"₹299",scale:2},
 {model:"#fries",name:"Fries",price:"₹99",scale:.5}
];

const holder=document.getElementById("holder");
const info=document.getElementById("info");
const loading=document.getElementById("loading");
const toast=document.getElementById("toast");
const ratingMenu=document.getElementById("ratingMenu");

let index=0,rating=0;
let yaw=0,pitch=0,vel=0,scale=foods[0].scale;
let autoRotate=true,lastTap=0;

const model=document.createElement("a-entity");
holder.appendChild(model);

function vibrate(t=15){ if(navigator.vibrate) navigator.vibrate(t); }

function showToast(t){
 toast.textContent=t;
 toast.style.opacity=1;
 setTimeout(()=>toast.style.opacity=0,1200);
}

function updateStars(){
 document.querySelectorAll(".star").forEach(s=>{
  s.classList.toggle("active",s.dataset.s<=rating);
 });
}

function animateInfo(text){
 info.style.opacity=0;
 info.style.transform="translate(-50%,-6px)";
 setTimeout(()=>{
  info.textContent=text;
  info.style.opacity=1;
  info.style.transform="translate(-50%,0)";
 },150);
}

function loadFood(i){
 loading.style.display="flex";
 model.setAttribute("gltf-model",foods[i].model);
 scale=foods[i].scale;
 model.object3D.scale.set(scale*.85,scale*.85,scale*.85);
 yaw=pitch=vel=0;
 animateInfo(`${foods[i].name} • ${foods[i].price}`);
 rating=0; updateStars();
 vibrate();
}

model.addEventListener("model-loaded",()=>{
 loading.style.display="none";
 model.object3D.scale.set(scale,scale,scale);
});

loadFood(0);

left.onclick=()=>{ index=(index+foods.length-1)%foods.length; loadFood(index); }
right.onclick=()=>{ index=(index+1)%foods.length; loadFood(index); }

rate.onclick=()=>{
 ratingMenu.style.display=
 ratingMenu.style.display==="block"?"none":"block";
 vibrate();
};

document.querySelectorAll(".star").forEach(s=>{
 s.onclick=()=>{
  rating=s.dataset.s;
  updateStars();
  showToast(`Rated ${rating} ★`);
  vibrate(25);
 };
});

/* -------- Rotation + Inertia -------- */
let dragging=false,lx=0,ly=0;

function start(x,y){
 dragging=true; lx=x; ly=y; autoRotate=false;
}
function move(x,y){
 const dx=x-lx;
 yaw+=dx*0.01;
 vel=dx*0.002;
 pitch+=(y-ly)*0.01;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lx=x; ly=y;
 model.object3D.rotation.set(pitch,yaw,0);
}
function end(){
 dragging=false;
 setTimeout(()=>autoRotate=true,2000);
}

document.addEventListener("mousedown",e=>start(e.clientX,e.clientY));
document.addEventListener("mousemove",e=>dragging&&move(e.clientX,e.clientY));
document.addEventListener("mouseup",end);

document.addEventListener("touchstart",e=>{
 const now=Date.now();
 if(now-lastTap<300){
  yaw=pitch=0;
  model.object3D.rotation.set(0,0,0);
  scale=foods[index].scale;
  model.object3D.scale.set(scale,scale,scale);
  showToast("View reset");
 }
 lastTap=now;
 if(e.touches.length===1)
  start(e.touches[0].clientX,e.touches[0].clientY);
});

document.addEventListener("touchmove",e=>{
 if(dragging && e.touches.length===1)
  move(e.touches[0].clientX,e.touches[0].clientY);
});

document.addEventListener("touchend",end);

AFRAME.registerComponent("spin",{tick:()=>{
 if(autoRotate){
  yaw+=vel;
  vel*=0.95;
  yaw+=0.002;
  model.object3D.rotation.y=yaw;
 }
}});
model.setAttribute("spin","");
</script>

</body>
</html>
