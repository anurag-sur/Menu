<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AR Food Menu</title>

<!-- DO NOT CHANGE -->
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0b0b0c;
  color:white;
}

/* ---------- Top Info ---------- */
#info{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 18px;
  background:rgba(20,20,22,.85);
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  z-index:5;
}

/* ---------- Buttons ---------- */
.btn{
  position:absolute;
  bottom:20px;
  padding:12px 18px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:background .15s, transform .1s;
}
.btn:active{
  transform:scale(.96);
  background:rgba(50,50,55,.95);
}

#left{ left:16px; }
#right{ right:16px; }

#addCart{
  left:50%;
  transform:translateX(-50%);
  background:rgba(31,122,255,.9);
  border-color:rgba(31,122,255,.3);
}

#viewCart{
  position:absolute;
  top:20px;
  right:20px;
  padding:10px 16px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:14px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  transition:background .15s, transform .1s;
  z-index:5;
}
#viewCart:active{
  transform:scale(.96);
  background:rgba(50,50,55,.95);
}

#cartBadge{
  position:absolute;
  top:-6px;
  right:-6px;
  background:#ff3b30;
  color:white;
  border-radius:10px;
  padding:2px 6px;
  font-size:11px;
  font-weight:600;
  min-width:18px;
  text-align:center;
}

/* ---------- Rating ---------- */
#ratingMenu{
  position:absolute;
  bottom:78px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 16px;
  background:rgba(20,20,22,.92);
  border-radius:16px;
  display:none;
  z-index:5;
}

.star{
  font-size:28px;
  cursor:pointer;
  color:rgba(255,255,255,.25);
  transition:color .15s, transform .1s;
}
.star.active{ color:#FFD54F; }
.star:active{ transform:scale(1.2); }

/* ---------- Cart Modal ---------- */
#cartModal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#cartContent{
  background:rgba(20,20,22,.98);
  border-radius:20px;
  padding:24px;
  width:90%;
  max-width:400px;
  max-height:80vh;
  overflow-y:auto;
  border:1px solid rgba(255,255,255,.1);
}

#cartContent h2{
  margin:0 0 16px 0;
  font-size:22px;
}

.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  background:rgba(40,40,45,.6);
  border-radius:12px;
  margin-bottom:10px;
}

.cart-item-info{
  flex:1;
}

.cart-item-name{
  font-weight:600;
  font-size:15px;
  margin-bottom:4px;
}

.cart-item-price{
  color:rgba(255,255,255,.6);
  font-size:13px;
}

.cart-item-controls{
  display:flex;
  align-items:center;
  gap:12px;
}

.qty-btn{
  width:28px;
  height:28px;
  border-radius:8px;
  background:rgba(60,60,65,.8);
  border:1px solid rgba(255,255,255,.1);
  color:white;
  font-size:16px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:background .15s;
}

.qty-btn:active{
  background:rgba(80,80,85,.9);
}

.qty{
  font-weight:600;
  min-width:24px;
  text-align:center;
}

#cartTotal{
  margin-top:20px;
  padding-top:16px;
  border-top:1px solid rgba(255,255,255,.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  font-weight:600;
}

.cart-actions{
  display:flex;
  gap:10px;
  margin-top:16px;
}

.cart-actions button{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:transform .1s;
}

.cart-actions button:active{
  transform:scale(.96);
}

#closeCart{
  background:rgba(60,60,65,.8);
  color:white;
}

#checkout{
  background:#1f7aff;
  color:white;
}

#emptyCart{
  text-align:center;
  padding:40px 20px;
  color:rgba(255,255,255,.5);
}

/* ---------- Toast ---------- */
#toast{
  position:absolute;
  top:72px;
  left:50%;
  transform:translateX(-50%);
  background:#1f7aff;
  padding:8px 14px;
  border-radius:12px;
  font-size:14px;
  opacity:0;
  transition:opacity .3s;
  z-index:6;
}

/* ---------- Loading ---------- */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0b0b0c;
  z-index:10;
  font-size:18px;
  font-weight:600;
}

a-scene {
  pointer-events: none;
}

#info,
#toast,
.btn,
#ratingMenu,
.star,
#viewCart,
#cartModal {
  pointer-events: auto;
}
  
</style>
</head>

<body>

<div id="info"></div>
<div id="toast"></div>
<div id="loading">Loading modelsâ€¦</div>

<button id="viewCart">
  ðŸ›’ Cart
  <span id="cartBadge" style="display:none;">0</span>
</button>

<button id="left" class="btn">â—€</button>
<button id="addCart" class="btn">Add to Cart</button>
<button id="right" class="btn">â–¶</button>

<div id="ratingMenu">
  <span class="star" data-s="1">â˜…</span>
  <span class="star" data-s="2">â˜…</span>
  <span class="star" data-s="3">â˜…</span>
  <span class="star" data-s="4">â˜…</span>
  <span class="star" data-s="5">â˜…</span>
</div>

<!-- Cart Modal -->
<div id="cartModal">
  <div id="cartContent">
    <h2>Your Cart</h2>
    <div id="cartItems"></div>
    <div id="emptyCart" style="display:none;">Your cart is empty</div>
    <div id="cartTotal" style="display:none;">
      <span>Total:</span>
      <span id="totalPrice">â‚¹0</span>
    </div>
    <div class="cart-actions">
      <button id="closeCart">Close</button>
      <button id="checkout">Checkout</button>
    </div>
  </div>
</div>

<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">

  <a-entity light="type:ambient;intensity:0.8"></a-entity>
  <a-entity light="type:directional;intensity:0.4" position="1 2 1"></a-entity>

  <a-entity camera></a-entity>
  <a-entity id="holder" position="0 0 -4"></a-entity>
</a-scene>

<script>
const foods=[
 {model:"models/burger/scene.gltf",name:"Burger",price:149,scale:.4},
 {model:"models/pizza/scene.gltf",name:"Pizza",price:299,scale:2},
 {model:"models/fries/scene.gltf",name:"Fries",price:99,scale:.5},
 {model:"models/assorted_salad/scene.gltf",name:"Assorted Salad",price:129,scale:6},
 {model:"models/chole_bhature/scene.gltf",name:"Chole Bhature",price:89,scale:6},
 {model:"models/grilled_sandwich/scene.gltf",name:"Grilled Sandwich",price:49,scale:6},
 {model:"models/palak_paneer/scene.gltf",name:"Palak Paneer",price:79,scale:6},
 {model:"models/potato_salad/scene.gltf",name:"Potato Salad",price:89,scale:.01},
 {model:"models/samosa/scene.gltf",name:"Samosa",price:39,scale:.5},
 {model:"models/soup_bowl/scene.gltf",name:"Soup Bowl",price:69,scale:.2}
];

const holder=document.getElementById("holder");
const info=document.getElementById("info");
const loading=document.getElementById("loading");
const toast=document.getElementById("toast");
const ratingMenu=document.getElementById("ratingMenu");
const cartModal=document.getElementById("cartModal");
const cartItems=document.getElementById("cartItems");
const cartBadge=document.getElementById("cartBadge");
const totalPrice=document.getElementById("totalPrice");
const emptyCart=document.getElementById("emptyCart");
const cartTotal=document.getElementById("cartTotal");

let index=0, rating=0;
let yaw=0,pitch=0,scale=foods[0].scale;
let autoRotate=true;
let cart=[];

const models=[];
let loadedCount=0;

/* ---------- Helpers ---------- */
function showToast(t){
 toast.textContent=t;
 toast.style.opacity=1;
 setTimeout(()=>toast.style.opacity=0,1200);
}

function updateStars(){
 document.querySelectorAll(".star").forEach(s=>{
  s.classList.toggle("active",s.dataset.s<=rating);
 });
}

function updateCartBadge(){
 const totalItems=cart.reduce((sum,item)=>sum+item.qty,0);
 if(totalItems>0){
  cartBadge.textContent=totalItems;
  cartBadge.style.display="block";
 }else{
  cartBadge.style.display="none";
 }
}

function updateCartDisplay(){
 if(cart.length===0){
  cartItems.innerHTML="";
  emptyCart.style.display="block";
  cartTotal.style.display="none";
  return;
 }
 
 emptyCart.style.display="none";
 cartTotal.style.display="flex";
 
 cartItems.innerHTML=cart.map((item,idx)=>`
  <div class="cart-item">
   <div class="cart-item-info">
    <div class="cart-item-name">${item.name}</div>
    <div class="cart-item-price">â‚¹${item.price} each</div>
   </div>
   <div class="cart-item-controls">
    <button class="qty-btn" onclick="changeQty(${idx},-1)">âˆ’</button>
    <span class="qty">${item.qty}</span>
    <button class="qty-btn" onclick="changeQty(${idx},1)">+</button>
   </div>
  </div>
 `).join("");
 
 const total=cart.reduce((sum,item)=>sum+(item.price*item.qty),0);
 totalPrice.textContent=`â‚¹${total}`;
}

function changeQty(idx,delta){
 cart[idx].qty+=delta;
 if(cart[idx].qty<=0){
  cart.splice(idx,1);
 }
 updateCartBadge();
 updateCartDisplay();
}

/* ---------- Preload all models ---------- */
foods.forEach((food,i)=>{
 const m=document.createElement("a-entity");
 m.setAttribute("gltf-model",food.model);
 m.object3D.scale.set(food.scale,food.scale,food.scale);
 m.object3D.visible=false;
 holder.appendChild(m);
 models.push(m);
 
 m.addEventListener("model-loaded",()=>{
  loadedCount++;
  loading.textContent=`Loading modelsâ€¦ ${loadedCount}/${foods.length}`;
  if(loadedCount===foods.length){
   loading.style.display="none";
   showFood(0);
  }
 });
});

/* ---------- Show ---------- */
function showFood(i){
 models.forEach((m,idx)=>{
  m.object3D.visible=(idx===i);
 });
 scale=foods[i].scale;
 yaw=pitch=0;
 models[i].object3D.rotation.set(0,0,0);
 info.textContent=`${foods[i].name} â€¢ â‚¹${foods[i].price}`;
 rating=0;
 updateStars();
}

/* ---------- UI ---------- */
left.onclick=()=>{ index=(index+foods.length-1)%foods.length; showFood(index); }
right.onclick=()=>{ index=(index+1)%foods.length; showFood(index); }

addCart.onclick=()=>{
 const food=foods[index];
 const existing=cart.find(item=>item.name===food.name);
 
 if(existing){
  existing.qty++;
 }else{
  cart.push({name:food.name,price:food.price,qty:1});
 }
 
 updateCartBadge();
 showToast(`${food.name} added to cart!`);
};

viewCart.onclick=()=>{
 updateCartDisplay();
 cartModal.style.display="flex";
};

closeCart.onclick=()=>{
 cartModal.style.display="none";
};

checkout.onclick=()=>{
 if(cart.length===0){
  showToast("Cart is empty!");
  return;
 }
 const total=cart.reduce((sum,item)=>sum+(item.price*item.qty),0);
 showToast(`Checkout: â‚¹${total} - Coming soon!`);
 cartModal.style.display="none";
};

cartModal.onclick=(e)=>{
 if(e.target===cartModal){
  cartModal.style.display="none";
 }
};

document.querySelectorAll(".star").forEach(s=>{
 s.onclick=()=>{
  rating=s.dataset.s;
  updateStars();
  showToast(`Rated ${rating} â˜…`);
 };
});

/* ---------- Input (Touch + Mouse) ---------- */
let dragging=false,lx=0,ly=0,zoom=0;

function dist(a,b){
 const dx=a.clientX-b.clientX;
 const dy=a.clientY-b.clientY;
 return Math.sqrt(dx*dx+dy*dy);
}

function start(x,y){
 dragging=true; lx=x; ly=y; autoRotate=false;
}
function move(x,y){
 yaw+=(x-lx)*0.01;
 pitch+=(y-ly)*0.01;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lx=x; ly=y;
 models[index].object3D.rotation.set(pitch,yaw,0);
}
function end(){
 dragging=false;
 setTimeout(()=>autoRotate=true,2000);
}

/* Touch */
document.addEventListener("touchstart",e=>{
 if(e.touches.length===1) start(e.touches[0].clientX,e.touches[0].clientY);
 if(e.touches.length===2) zoom=dist(e.touches[0],e.touches[1]);
});
document.addEventListener("touchmove",e=>{
 if(e.touches.length===2){
  const d=dist(e.touches[0],e.touches[1]);
  scale*=d/zoom;
  models[index].object3D.scale.set(scale,scale,scale);
  zoom=d;
 }
 if(dragging && e.touches.length===1)
  move(e.touches[0].clientX,e.touches[0].clientY);
});
document.addEventListener("touchend",end);

/* Mouse */
document.addEventListener("mousedown",e=>start(e.clientX,e.clientY));
document.addEventListener("mousemove",e=>dragging&&move(e.clientX,e.clientY));
document.addEventListener("mouseup",end);
document.addEventListener("wheel",e=>{
 scale+=e.deltaY*-0.001;
 models[index].object3D.scale.set(scale,scale,scale);
});

/* Auto rotate */
AFRAME.registerComponent("spin",{tick:()=>{
 if(autoRotate){
  yaw+=0.002;
  models[index].object3D.rotation.y=yaw;
 }
}});
holder.setAttribute("spin","");
</script>

</body>
</html>
