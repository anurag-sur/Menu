<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AR Food Menu</title>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js "></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js "></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400 ;600;700&display=swap" rel="stylesheet">
<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0b0b0c;
  color:white;
}

/* ---------- Top Bar ---------- */
#topBar{
  position:absolute;
  top:0;
  left:0;
  right:0;
  padding:12px 20px;
  background:linear-gradient(180deg, rgba(0,0,0,.6) 0%, transparent 100%);
  z-index:5;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#logo{
  font-size:18px;
  font-weight:700;
  letter-spacing:-0.5px;
}

#topActions{
  display:flex;
  gap:8px;
}

.top-btn{
  width:40px;
  height:40px;
  background:rgba(30,30,32,.85);
  border:1px solid rgba(255,255,255,.1);
  border-radius:50%;
  color:white;
  font-size:18px;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.top-btn:active{
  transform:scale(.95);
  background:rgba(50,50,55,.9);
}

#viewCart{
  position:relative;
}

#cartBadge{
  position:absolute;
  top:-6px;
  right:-6px;
  background:#ff3b30;
  color:white;
  border-radius:10px;
  padding:2px 6px;
  font-size:11px;
  font-weight:700;
  min-width:18px;
  text-align:center;
}

/* ---------- Info Card ---------- */
#infoCard{
  position:absolute;
  top:60px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:320px;
  padding:12px 16px;
  background:rgba(20,20,22,.92);
  backdrop-filter:blur(20px);
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  z-index:5;
  box-shadow:0 8px 24px rgba(0,0,0,.3);
}

#foodName{
  font-size:18px;
  font-weight:700;
  margin-bottom:4px;
}

#foodPrice{
  font-size:18px;
  font-weight:700;
  color:#4CAF50;
  margin-bottom:6px;
}

#foodStats{
  display:flex;
  gap:10px;
  font-size:11px;
  color:rgba(255,255,255,.5);
  margin-top:6px;
  padding-top:8px;
  border-top:1px solid rgba(255,255,255,.08);
}

.stat{
  display:flex;
  align-items:center;
  gap:4px;
}

/* ---------- Quick Actions ---------- */
#quickActions{
  position:absolute;
  left:20px;
  top:50%;
  transform:translateY(-50%);
  display:flex;
  flex-direction:column;
  gap:12px;
  z-index:5;
}

.quick-btn{
  width:48px;
  height:48px;
  background:rgba(30,30,32,.88);
  border:1px solid rgba(255,255,255,.1);
  border-radius:50%;
  color:white;
  font-size:20px;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(10px);
}

.quick-btn:active{
  transform:scale(.95);
  background:rgba(50,50,55,.9);
}

.quick-btn.active{
  background:rgba(31,122,255,.85);
  border-color:rgba(31,122,255,.3);
  box-shadow:0 4px 16px rgba(31,122,255,.3);
}

/* ---------- Main Controls ---------- */
#controls{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  padding:20px;
  background:linear-gradient(0deg, rgba(0,0,0,.7) 0%, transparent 100%);
  z-index:5;
}

#navButtons{
  display:flex;
  gap:12px;
  margin-bottom:16px;
  justify-content:center;
  align-items: center;
}

.nav-btn{
  width:56px;
  height:56px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:50%;
  font-size:24px;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(10px);
  flex-shrink: 0;
}

.nav-btn:active{
  transform:scale(.94);
  background:rgba(50,50,55,.95);
}

#addCart{
  flex:1;
  max-width:200px;
  background:linear-gradient(135deg, #1f7aff 0%, #0066ff 100%);
  border-color:rgba(31,122,255,.3);
  font-weight:700;
  font-size:16px;
  box-shadow:0 4px 20px rgba(31,122,255,.4);
  border-radius:16px;
  height:56px;
  border: none;
}

/* ---------- FAB ---------- */
.fab {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 64px;
  height: 64px;
  background: linear-gradient(135deg, #1f7aff 0%, #0066ff 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 24px;
  cursor: pointer;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(31, 122, 255, 0.4);
  transition: all 0.3s;
}

.fab.active {
  background: #ff3b30;
}

.fab.active .fab-icon::before {
  content: "‚úï";
}

.fab-menu {
  position: fixed;
  bottom: 96px;
  right: 24px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 99;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}

.fab-menu.show {
  opacity: 1;
  pointer-events: all;
}

.fab-menu-item {
  width: 48px;
  height: 48px;
  background: rgba(40, 40, 45, 0.85);
  border-radius: 50%;
  color: white;
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}

.fab-menu-item:active {
  transform: scale(0.9);
  background: rgba(60, 60, 65, 0.95);
}

/* ---------- Filter Menu ---------- */
#filterMenu{
  position:absolute;
  top:80px;
  left:20px;
  right:20px;
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:18px;
  border:1px solid rgba(255,255,255,.1);
  padding:20px;
  display:none;
  z-index:100;
  box-shadow:0 8px 32px rgba(0,0,0,.4);
}

#filterMenu.show{
  display:block;
}

.filter-section{
  margin-bottom:20px;
}

.filter-section:last-child{
  margin-bottom:0;
}

.filter-title{
  font-size:14px;
  font-weight:700;
  margin-bottom:10px;
  color:rgba(255,255,255,.7);
  text-transform:uppercase;
  letter-spacing:0.5px;
}

.filter-options{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.filter-chip{
  padding:8px 14px;
  background:rgba(40,40,45,.6);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px;
  color:white;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  transition:all .15s;
}

.filter-chip:active{
  transform:scale(.95);
}

.filter-chip.active{
  background:rgba(31,122,255,.8);
  border-color:rgba(31,122,255,.3);
}

/* ---------- Cart Modal ---------- */
#cartModal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#cartContent{
  background:rgba(20,20,22,.98);
  border-radius:24px;
  padding:28px 24px;
  width:90%;
  max-width:420px;
  max-height:80vh;
  overflow-y:auto;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

#cartHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

#cartHeader h2{
  margin:0;
  font-size:24px;
  font-weight:700;
}

.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  background:rgba(40,40,45,.6);
  border-radius:14px;
  margin-bottom:12px;
  border:1px solid rgba(255,255,255,.05);
}

.cart-item-info{
  flex:1;
}

.cart-item-name{
  font-weight:600;
  font-size:15px;
  margin-bottom:4px;
}

.cart-item-price{
  color:rgba(255,255,255,.5);
  font-size:13px;
}

.cart-item-controls{
  display:flex;
  align-items:center;
  gap:12px;
}

.qty-btn{
  width:32px;
  height:32px;
  border-radius:10px;
  background:rgba(60,60,65,.8);
  border:1px solid rgba(255,255,255,.1);
  color:white;
  font-size:18px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .15s;
  font-weight:600;
}

.qty-btn:active{
  background:rgba(80,80,85,.9);
  transform:scale(.9);
}

.qty{
  font-weight:700;
  min-width:28px;
  text-align:center;
  font-size:16px;
}

#cartTotal{
  margin-top:20px;
  padding-top:20px;
  border-top:1px solid rgba(255,255,255,.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:20px;
  font-weight:700;
}

#totalPrice{
  color:#4CAF50;
}

.cart-actions{
  display:flex;
  gap:12px;
  margin-top:20px;
}

.cart-actions button{
  flex:1;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

.cart-actions button:active{
  transform:scale(.96);
}

#closeCart{
  background:rgba(60,60,65,.8);
  color:white;
  border:1px solid rgba(255,255,255,.1);
}

#checkout{
  background:linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  color:white;
  box-shadow:0 4px 20px rgba(76,175,80,.4);
}

#checkout:disabled{
  background:rgba(60,60,65,.5);
  cursor:not-allowed;
  box-shadow:none;
}

#emptyCart{
  text-align:center;
  padding:40px 20px;
  color:rgba(255,255,255,.4);
  font-size:15px;
}

/* ---------- Toast ---------- */
#toast{
  position:absolute;
  top:90px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(31,122,255,.95);
  backdrop-filter:blur(20px);
  padding:12px 18px;
  border-radius:12px;
  font-size:14px;
  font-weight:600;
  opacity:0;
  transition:opacity .3s;
  z-index:101;
  box-shadow:0 4px 20px rgba(31,122,255,.4);
}

/* ---------- Loading ---------- */
#loading{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#0b0b0c;
  z-index:102;
  gap:16px;
}

#loadingText{
  font-size:18px;
  font-weight:600;
}

#loadingBar{
  width:200px;
  height:4px;
  background:rgba(255,255,255,.1);
  border-radius:2px;
  overflow:hidden;
}

#loadingProgress{
  height:100%;
  background:linear-gradient(90deg, #1f7aff, #0066ff);
  width:0%;
  transition:width .3s;
}

/* ---------- Rating ---------- */
#ratingMenu{
  position:absolute;
  bottom:200px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 18px;
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  display:none;
  z-index:5;
  align-items:center;
  gap:6px;
  box-shadow:0 8px 32px rgba(0,0,0,.4);
}

#ratingMenu.show{
  display:flex;
}

.star{
  font-size:32px;
  cursor:pointer;
  color:rgba(255,255,255,.2);
  transition:all .2s;
  line-height:1;
}
.star.active{
  color:#FFD54F;
  text-shadow:0 0 12px rgba(255,213,79,.5);
}
.star:active{ transform:scale(1.3); }

a-scene {
  pointer-events: none;
}

#topBar,
#infoCard,
#toast,
#controls,
#quickActions,
#actionBar,
.nav-btn,
.action-btn,
.quick-btn,
.top-btn,
#ratingMenu,
.star,
#cartModal,
#filterMenu,
.fab,
.fab-menu {
  pointer-events: auto;
}

/* Scrollbar for cart */
#cartContent::-webkit-scrollbar{
  width:6px;
}

#cartContent::-webkit-scrollbar-track{
  background:transparent;
}

#cartContent::-webkit-scrollbar-thumb{
  background:rgba(255,255,255,.2);
  border-radius:3px;
}

/* ---------- Mobile Responsive ---------- */
@media (max-width: 768px) {
  #quickActions {
    left: auto;
    right: 20px;
    top: auto;
    bottom: 140px;
    transform: none;
    flex-direction: row;
  }
  
  .quick-btn {
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
  
  #controls {
    padding: 16px;
  }
  
  #navButtons {
    gap: 8px;
    margin-bottom: 8px;
  }
  
  .nav-btn {
    width: 48px;
    height: 48px;
    font-size: 20px;
  }
  
  #addCart {
    height: 48px;
    font-size: 14px;
    max-width: 140px;
  }
  
  #infoCard {
    top: 70px;
    padding: 10px 14px;
  }
  
  #foodName {
    font-size: 16px;
  }
  
  #foodPrice {
    font-size: 16px;
  }
  
  #foodStats {
    font-size: 10px;
    gap: 8px;
  }
  
  .fab {
    width: 56px;
    height: 56px;
    font-size: 22px;
  }
  
  .fab-menu {
    bottom: 88px;
    right: 20px;
  }
  
  .fab-menu-item {
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
  
  #ratingMenu {
    bottom: 120px;
  }
  
  .star {
    font-size: 28px;
  }
  
  #filterMenu {
    top: 70px;
    left: 10px;
    right: 10px;
    padding: 16px;
  }
  
  .filter-chip {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  #topBar {
    padding: 10px 16px;
  }
  
  #logo {
    font-size: 16px;
  }
  
  .top-btn {
    width: 36px;
    height: 36px;
    font-size: 16px;
  }
}

/* ---------- Favorites Modal ---------- */
#favoritesModal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#favoritesContent{
  background:rgba(20,20,22,.98);
  border-radius:24px;
  padding:28px 24px;
  width:90%;
  max-width:420px;
  max-height:80vh;
  overflow-y:auto;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

#favoritesHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

#favoritesHeader h2{
  margin:0;
  font-size:24px;
  font-weight:700;
}

.favorite-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  background:rgba(40,40,45,.6);
  border-radius:14px;
  margin-bottom:12px;
  border:1px solid rgba(255,255,255,.05);
}

.favorite-item-info{
  flex:1;
}

.favorite-item-name{
  font-weight:600;
  font-size:15px;
  margin-bottom:4px;
}

.favorite-item-price{
  color:rgba(255,255,255,.5);
  font-size:13px;
}

.favorite-item-actions{
  display:flex;
  align-items:center;
  gap:8px;
}

.fav-action-btn{
  width:36px;
  height:36px;
  border-radius:10px;
  background:rgba(60,60,65,.8);
  border:1px solid rgba(255,255,255,.1);
  color:white;
  font-size:16px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .15s;
}

.fav-action-btn:active{
  background:rgba(80,80,85,.9);
  transform:scale(.9);
}

.fav-action-btn.add{
  background:rgba(31,122,255,.8);
}

#emptyFavorites{
  text-align:center;
  padding:40px 20px;
  color:rgba(255,255,255,.4);
  font-size:15px;
}

/* ---------- Compare Modal ---------- */
#compareModal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#compareContent{
  background:rgba(20,20,22,.98);
  border-radius:24px;
  padding:28px 24px;
  width:95%;
  max-width:600px;
  max-height:80vh;
  overflow-y:auto;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

#compareHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

#compareHeader h2{
  margin:0;
  font-size:24px;
  font-weight:700;
}

.compare-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
  gap:16px;
  margin-bottom:20px;
}

.compare-item{
  background:rgba(40,40,45,.6);
  border-radius:14px;
  padding:16px;
  border:1px solid rgba(255,255,255,.05);
  text-align:center;
}

.compare-item-name{
  font-weight:600;
  font-size:14px;
  margin-bottom:8px;
}

.compare-item-price{
  color:#4CAF50;
  font-size:18px;
  font-weight:700;
  margin-bottom:8px;
}

.compare-item-stats{
  font-size:11px;
  color:rgba(255,255,255,.5);
  margin-bottom:12px;
}

.compare-item-rating{
  color:#FFD54F;
  font-size:14px;
  margin-bottom:12px;
}

.compare-remove-btn{
  width:100%;
  padding:8px;
  border-radius:8px;
  background:rgba(255,59,48,.8);
  border:none;
  color:white;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  transition:all .15s;
}

.compare-remove-btn:active{
  transform:scale(.96);
}

#emptyCompare{
  text-align:center;
  padding:40px 20px;
  color:rgba(255,255,255,.4);
  font-size:15px;
}

.compare-actions{
  display:flex;
  gap:12px;
}

.compare-actions button{
  flex:1;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:all .15s;
}

.compare-actions button:active{
  transform:scale(.96);
}

#closeCompare{
  background:rgba(60,60,65,.8);
  color:white;
  border:1px solid rgba(255,255,255,.1);
}

#clearCompare{
  background:rgba(255,59,48,.8);
  color:white;
}

/* ---------- Voice Search ---------- */
#voiceBtn{
  position:absolute;
  top:60px;
  right:20px;
  width:44px;
  height:44px;
  background:rgba(31,122,255,.9);
  border:1px solid rgba(31,122,255,.3);
  border-radius:50%;
  color:white;
  font-size:20px;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
  backdrop-filter:blur(10px);
  box-shadow:0 4px 16px rgba(31,122,255,.3);
}

#voiceBtn:active{
  transform:scale(.95);
  background:rgba(31,122,255,1);
}

#voiceBtn.listening{
  animation:pulse 1.5s infinite;
  background:#ff3b30;
  border-color:rgba(255,59,48,.3);
}

@keyframes pulse{
  0%,100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(255,59,48,.4); }
  50%{ transform:scale(1.05); box-shadow:0 0 0 10px rgba(255,59,48,0); }
}

/* ---------- Search Results ---------- */
#searchResults{
  position:absolute;
  top:110px;
  right:20px;
  width:280px;
  max-height:300px;
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:14px;
  border:1px solid rgba(255,255,255,.1);
  padding:12px;
  display:none;
  z-index:5;
  box-shadow:0 8px 32px rgba(0,0,0,.4);
  overflow-y:auto;
}

#searchResults.show{
  display:block;
}

.search-result-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  transition:all .15s;
  margin-bottom:8px;
}

.search-result-item:last-child{
  margin-bottom:0;
}

.search-result-item:hover{
  background:rgba(40,40,45,.6);
}

.search-result-icon{
  width:40px;
  height:40px;
  background:rgba(31,122,255,.2);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
}

.search-result-info{
  flex:1;
}

.search-result-name{
  font-weight:600;
  font-size:14px;
  margin-bottom:2px;
}

.search-result-price{
  color:#4CAF50;
  font-size:12px;
}

/* ---------- Nutrition Info ---------- */
#nutritionModal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#nutritionContent{
  background:rgba(20,20,22,.98);
  border-radius:24px;
  padding:28px 24px;
  width:90%;
  max-width:380px;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

#nutritionHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

#nutritionHeader h2{
  margin:0;
  font-size:20px;
  font-weight:700;
}

.nutrition-grid{
  display:grid;
  grid-template-columns:repeat(2, 1fr);
  gap:12px;
  margin-bottom:20px;
}

.nutrition-item{
  background:rgba(40,40,45,.6);
  border-radius:12px;
  padding:16px;
  text-align:center;
  border:1px solid rgba(255,255,255,.05);
}

.nutrition-value{
  font-size:24px;
  font-weight:700;
  color:#1f7aff;
  margin-bottom:4px;
}

.nutrition-label{
  font-size:12px;
  color:rgba(255,255,255,.5);
  text-transform:uppercase;
  letter-spacing:0.5px;
}

.nutrition-bar{
  height:6px;
  background:rgba(255,255,255,.1);
  border-radius:3px;
  margin-top:8px;
  overflow:hidden;
}

.nutrition-bar-fill{
  height:100%;
  background:linear-gradient(90deg, #1f7aff, #0066ff);
  border-radius:3px;
  transition:width .3s;
}

#closeNutrition{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  background:rgba(60,60,65,.8);
  color:white;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:all .15s;
}

#closeNutrition:active{
  transform:scale(.96);
  background:rgba(80,80,85,.9);
}

/* ---------- AR Instructions ---------- */
#arInstructions{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:20px;
  padding:24px;
  text-align:center;
  z-index:50;
  display:none;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 8px 32px rgba(0,0,0,.4);
  max-width:300px;
}

#arInstructions.show{
  display:block;
}

.ar-instruction-icon{
  font-size:48px;
  margin-bottom:16px;
}

.ar-instruction-text{
  font-size:16px;
  font-weight:600;
  margin-bottom:8px;
}

.ar-instruction-subtext{
  font-size:13px;
  color:rgba(255,255,255,.5);
  margin-bottom:20px;
}

#arInstructions button{
  padding:12px 24px;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg, #1f7aff 0%, #0066ff 100%);
  color:white;
  font-size:14px;
  font-weight:700;
  cursor:pointer;
  transition:all .15s;
}

#arInstructions button:active{
  transform:scale(.96);
}

/* ---------- Dark Mode Toggle ---------- */
#darkModeToggle{
  position:absolute;
  top:60px;
  left:20px;
  width:44px;
  height:44px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.1);
  border-radius:50%;
  color:white;
  font-size:20px;
  cursor:pointer;
  transition:all .15s;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
  backdrop-filter:blur(10px);
}

#darkModeToggle:active{
  transform:scale(.95);
  background:rgba(50,50,55,.9);
}

body.light-mode{
  background:#f5f5f7;
  color:#1a1a1a;
}

body.light-mode #topBar{
  background:linear-gradient(180deg, rgba(255,255,255,.8) 0%, transparent 100%);
}

body.light-mode #infoCard,
body.light-mode #filterMenu,
body.light-mode #searchResults,
body.light-mode #arInstructions{
  background:rgba(255,255,255,.95);
  border-color:rgba(0,0,0,.1);
  color:#1a1a1a;
}

body.light-mode .quick-btn,
body.light-mode .nav-btn,
body.light-mode .top-btn,
body.light-mode #darkModeToggle{
  background:rgba(255,255,255,.9);
  border-color:rgba(0,0,0,.1);
  color:#1a1a1a;
}

body.light-mode #foodStats,
body.light-mode .search-result-price,
body.light-mode .ar-instruction-subtext{
  color:rgba(0,0,0,.5);
}

body.light-mode .filter-chip{
  background:rgba(0,0,0,.05);
  border-color:rgba(0,0,0,.1);
  color:#1a1a1a;
}

body.light-mode .filter-chip.active{
  background:rgba(31,122,255,.8);
  color:white;
}

/* ---------- Gesture Hint ---------- */
#gestureHint{
  position:absolute;
  bottom:100px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(10px);
  padding:8px 16px;
  border-radius:20px;
  font-size:12px;
  color:rgba(255,255,255,.7);
  z-index:5;
  opacity:0;
  transition:opacity .3s;
  pointer-events:none;
}

#gestureHint.show{
  opacity:1;
}

/* ---------- Recently Viewed ---------- */
#recentlyViewed{
  position:absolute;
  bottom:200px;
  left:20px;
  display:flex;
  flex-direction:column;
  gap:8px;
  z-index:5;
}

.recent-item{
  width:48px;
  height:48px;
  background:rgba(30,30,32,.88);
  border:1px solid rgba(255,255,255,.1);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all .15s;
  font-size:24px;
  backdrop-filter:blur(10px);
}

.recent-item:hover{
  transform:scale(1.1);
  background:rgba(50,50,55,.9);
}

.recent-item.active{
  border-color:#1f7aff;
  box-shadow:0 0 0 2px rgba(31,122,255,.3);
}

body.light-mode .recent-item{
  background:rgba(255,255,255,.9);
  border-color:rgba(0,0,0,.1);
}

/* ---------- Quantity Selector ---------- */
#quantitySelector{
  position:absolute;
  bottom:100px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(20,20,22,.95);
  backdrop-filter:blur(20px);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  padding:12px 20px;
  display:none;
  align-items:center;
  gap:16px;
  z-index:5;
  box-shadow:0 8px 32px rgba(0,0,0,.4);
}

#quantitySelector.show{
  display:flex;
}

.qty-display{
  font-size:18px;
  font-weight:700;
  min-width:30px;
  text-align:center;
}

.qty-nav-btn{
  width:36px;
  height:36px;
  border-radius:50%;
  background:rgba(40,40,45,.6);
  border:1px solid rgba(255,255,255,.1);
  color:white;
  font-size:18px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .15s;
}

.qty-nav-btn:active{
  transform:scale(.9);
  background:rgba(60,60,65,.8);
}

body.light-mode #quantitySelector{
  background:rgba(255,255,255,.95);
  border-color:rgba(0,0,0,.1);
}

body.light-mode .qty-nav-btn{
  background:rgba(0,0,0,.05);
  border-color:rgba(0,0,0,.1);
  color:#1a1a1a;
}

body.light-mode .qty-display{
  color:#1a1a1a;
}
</style>
</head>

<body>

<!-- Top Bar -->
<div id="topBar">
  <div id="logo">üçî FoodAR</div>
  <div id="topActions">
    <button class="top-btn" id="filterBtn">üîç</button>
    <button class="top-btn" id="viewCart">
      üõí
      <span id="cartBadge" style="display:none;">0</span>
    </button>
  </div>
</div>

<!-- Dark Mode Toggle -->
<button id="darkModeToggle">üåô</button>

<!-- Voice Search -->
<button id="voiceBtn">üé§</button>

<!-- Search Results -->
<div id="searchResults"></div>

<!-- Info Card -->
<div id="infoCard">
  <div id="foodName"></div>
  <div id="foodPrice"></div>
  <div id="foodStats">
    <span class="stat">üëÅÔ∏è <span id="viewCount">0</span> views</span>
    <span class="stat">‚≠ê <span id="avgRating">0.0</span></span>
    <span class="stat">üõí <span id="orderCount">0</span> orders</span>
  </div>
</div>

<!-- Filter Menu -->
<div id="filterMenu">
  <div class="filter-section">
    <div class="filter-title">Price Range</div>
    <div class="filter-options">
      <button class="filter-chip active" data-filter="all">All</button>
      <button class="filter-chip" data-filter="budget">Under ‚Çπ50</button>
      <button class="filter-chip" data-filter="mid">‚Çπ50-‚Çπ150</button>
      <button class="filter-chip" data-filter="premium">‚Çπ150+</button>
    </div>
  </div>
  <div class="filter-section">
    <div class="filter-title">Category</div>
    <div class="filter-options">
      <button class="filter-chip active" data-category="all">All</button>
      <button class="filter-chip" data-category="indian">Indian</button>
      <button class="filter-chip" data-category="western">Western</button>
      <button class="filter-chip" data-category="healthy">Healthy</button>
    </div>
  </div>
</div>

<div id="toast"></div>
<div id="loading">
  <div id="loadingText">Loading models‚Ä¶</div>
  <div id="loadingBar">
    <div id="loadingProgress"></div>
  </div>
</div>

<!-- Gesture Hint -->
<div id="gestureHint">üëÜ Drag to rotate ‚Ä¢ ü§è Pinch to zoom</div>

<!-- Recently Viewed -->
<div id="recentlyViewed"></div>

<!-- Quick Actions -->
<div id="quickActions">
  <button class="quick-btn" id="resetBtn">üîÑ</button>
  <button class="quick-btn active" id="toggleRotate">‚Üª</button>
  <button class="quick-btn" id="shareBtn">üì§</button>
  <button class="quick-btn" id="nutritionBtn">ü•ó</button>
  <button class="quick-btn" id="arBtn">üì±</button>
</div>

<!-- Quantity Selector -->
<div id="quantitySelector">
  <button class="qty-nav-btn" id="qtyMinus">‚àí</button>
  <span class="qty-display" id="qtyDisplay">1</span>
  <button class="qty-nav-btn" id="qtyPlus">+</button>
</div>

<!-- Main Controls -->
<div id="controls">
  <div id="navButtons">
    <button class="nav-btn" id="left">‚Äπ</button>
    <button class="nav-btn" id="addCart">Add to Cart</button>
    <button class="nav-btn" id="right">‚Ä∫</button>
  </div>
</div>

<!-- FAB -->
<div id="fab" class="fab">
  <div class="fab-icon">üõí</div>
</div>
<div id="fabMenu" class="fab-menu">
  <button class="fab-menu-item" id="favoriteFab">‚ù§Ô∏è</button>
  <button class="fab-menu-item" id="rateFab">‚≠ê</button>
  <button class="fab-menu-item" id="compareFab">‚öñÔ∏è</button>
  <button class="fab-menu-item" id="viewFavoritesFab">üìã</button>
</div>

<!-- Rating -->
<div id="ratingMenu">
  <span class="star" data-s="1">‚òÖ</span>
  <span class="star" data-s="2">‚òÖ</span>
  <span class="star" data-s="3">‚òÖ</span>
  <span class="star" data-s="4">‚òÖ</span>
  <span class="star" data-s="5">‚òÖ</span>
</div>

<!-- Cart Modal -->
<div id="cartModal">
  <div id="cartContent">
    <div id="cartHeader">
      <h2>Your Cart</h2>
      <span id="itemCount" style="color:rgba(255,255,255,.5);font-size:14px;"></span>
    </div>
    <div id="cartItems"></div>
    <div id="emptyCart" style="display:none;">Your cart is empty üõí</div>
    <div id="cartTotal" style="display:none;">
      <span>Total:</span>
      <span id="totalPrice">‚Çπ0</span>
    </div>
    <div class="cart-actions">
      <button id="closeCart">Close</button>
      <button id="checkout">Checkout</button>
    </div>
  </div>
</div>

<!-- Favorites Modal -->
<div id="favoritesModal">
  <div id="favoritesContent">
    <div id="favoritesHeader">
      <h2>Your Favorites</h2>
      <button class="top-btn" id="closeFavorites">‚úï</button>
    </div>
    <div id="favoritesItems"></div>
    <div id="emptyFavorites">No favorites yet ‚ù§Ô∏è</div>
  </div>
</div>

<!-- Compare Modal -->
<div id="compareModal">
  <div id="compareContent">
    <div id="compareHeader">
      <h2>Compare Items</h2>
      <button class="top-btn" id="closeCompare">‚úï</button>
    </div>
    <div id="compareItems"></div>
    <div id="emptyCompare">Add items to compare ‚öñÔ∏è</div>
    <div class="compare-actions">
      <button id="closeCompareBtn">Close</button>
      <button id="clearCompare">Clear All</button>
    </div>
  </div>
</div>

<!-- Nutrition Modal -->
<div id="nutritionModal">
  <div id="nutritionContent">
    <div id="nutritionHeader">
      <h2>Nutrition Info</h2>
      <button class="top-btn" id="closeNutrition">‚úï</button>
    </div>
    <div class="nutrition-grid" id="nutritionGrid">
      <div class="nutrition-item">
        <div class="nutrition-value" id="calories">0</div>
        <div class="nutrition-label">Calories</div>
        <div class="nutrition-bar"><div class="nutrition-bar-fill" style="width: 0%"></div></div>
      </div>
      <div class="nutrition-item">
        <div class="nutrition-value" id="protein">0g</div>
        <div class="nutrition-label">Protein</div>
        <div class="nutrition-bar"><div class="nutrition-bar-fill" style="width: 0%"></div></div>
      </div>
      <div class="nutrition-item">
        <div class="nutrition-value" id="carbs">0g</div>
        <div class="nutrition-label">Carbs</div>
        <div class="nutrition-bar"><div class="nutrition-bar-fill" style="width: 0%"></div></div>
      </div>
      <div class="nutrition-item">
        <div class="nutrition-value" id="fat">0g</div>
        <div class="nutrition-label">Fat</div>
        <div class="nutrition-bar"><div class="nutrition-bar-fill" style="width: 0%"></div></div>
      </div>
    </div>
    <button id="closeNutritionBtn">Close</button>
  </div>
</div>

<!-- AR Instructions -->
<div id="arInstructions">
  <div class="ar-instruction-icon">üì±</div>
  <div class="ar-instruction-text">AR Mode Ready</div>
  <div class="ar-instruction-subtext">Point your camera at a flat surface to place the food</div>
  <button id="startAR">Start AR</button>
</div>

<a-scene embedded vr-mode-ui="enabled:false"
         arjs="sourceType:webcam; debugUIEnabled:false;">
  <a-entity light="type:ambient;intensity:0.8"></a-entity>
  <a-entity light="type:directional;intensity:0.4" position="1 2 1"></a-entity>
  <a-entity camera></a-entity>
  <a-entity id="holder" position="0 0 -4"></a-entity>
</a-scene>

<script>
const foods=[
 {model:"models/burger/scene.gltf",name:"Burger",price:149,scale:.4,category:"western",views:1250,rating:4.5,orders:342,calories:295,protein:17,carbs:30,fat:14},
 {model:"models/pizza/scene.gltf",name:"Pizza",price:299,scale:2,category:"western",views:2100,rating:4.8,orders:521,calories:266,protein:11,carbs:33,fat:10},
 {model:"models/fries/scene.gltf",name:"Fries",price:99,scale:.5,category:"western",views:890,rating:4.2,orders:267,calories:312,protein:3,carbs:41,fat:15},
 {model:"models/assorted_salad/scene.gltf",name:"Assorted Salad",price:129,scale:6,category:"healthy",views:456,rating:4.3,orders:89,calories:152,protein:5,carbs:12,fat:10},
 {model:"models/chole_bhature/scene.gltf",name:"Chole Bhature",price:89,scale:6,category:"indian",views:1567,rating:4.7,orders:423,calories:450,protein:12,carbs:58,fat:20},
 {model:"models/grilled_sandwich/scene.gltf",name:"Grilled Sandwich",price:49,scale:6,category:"western",views:678,rating:4.1,orders:198,calories:220,protein:8,carbs:28,fat:9},
 {model:"models/palak_paneer/scene.gltf",name:"Palak Paneer",price:79,scale:6,category:"indian",views:1123,rating:4.6,orders:312,calories:280,protein:14,carbs:15,fat:20},
 {model:"models/potato_salad/scene.gltf",name:"Potato Salad",price:89,scale:.01,category:"healthy",views:345,rating:4.0,orders:76,calories:143,protein:3,carbs:17,fat:8},
 {model:"models/samosa/scene.gltf",name:"Samosa",price:39,scale:.5,category:"indian",views:2345,rating:4.9,orders:678,calories:262,protein:4,carbs:32,fat:14}
];

const holder=document.getElementById("holder");
const infoCard=document.getElementById("infoCard");
const foodName=document.getElementById("foodName");
const foodPrice=document.getElementById("foodPrice");
const viewCount=document.getElementById("viewCount");
const avgRating=document.getElementById("avgRating");
const orderCount=document.getElementById("orderCount");
const loading=document.getElementById("loading");
const loadingText=document.getElementById("loadingText");
const loadingProgress=document.getElementById("loadingProgress");
const toast=document.getElementById("toast");
const cartModal=document.getElementById("cartModal");
const cartItems=document.getElementById("cartItems");
const cartBadge=document.getElementById("cartBadge");
const totalPrice=document.getElementById("totalPrice");
const emptyCart=document.getElementById("emptyCart");
const cartTotal=document.getElementById("cartTotal");
const itemCount=document.getElementById("itemCount");
const filterMenu=document.getElementById("filterMenu");
const fab = document.getElementById("fab");
const fabMenu = document.getElementById("fabMenu");
const ratingMenu = document.getElementById("ratingMenu");
const favoritesModal = document.getElementById("favoritesModal");
const favoritesItems = document.getElementById("favoritesItems");
const emptyFavorites = document.getElementById("emptyFavorites");
const compareModal = document.getElementById("compareModal");
const compareItems = document.getElementById("compareItems");
const emptyCompare = document.getElementById("emptyCompare");
const nutritionModal = document.getElementById("nutritionModal");
const voiceBtn = document.getElementById("voiceBtn");
const searchResults = document.getElementById("searchResults");
const gestureHint = document.getElementById("gestureHint");
const recentlyViewed = document.getElementById("recentlyViewed");
const quantitySelector = document.getElementById("quantitySelector");
const qtyDisplay = document.getElementById("qtyDisplay");
const arInstructions = document.getElementById("arInstructions");

let index=0, rating=0;
let yaw=0,pitch=0,scale=foods[0].scale;
let autoRotate=true;
let cart=[];
let favorites=[];
let compareList=[];
let currentFilter="all";
let currentCategory="all";
let fabTimeout;
let currentQty = 1;
let recentlyViewedList = [];
let isDarkMode = true;
let isListening = false;

const models=[];
let loadedCount=0;

/* ---------- Helpers ---------- */
function showToast(t){
 toast.textContent=t;
 toast.style.opacity=1;
 setTimeout(()=>toast.style.opacity=0,1800);
}

function updateStars(){
 document.querySelectorAll(".star").forEach(s=>{
  s.classList.toggle("active",s.dataset.s<=rating);
 });
}

function updateCartBadge(){
 const totalItems=cart.reduce((sum,item)=>sum+item.qty,0);
 if(totalItems>0){
  cartBadge.textContent=totalItems;
  cartBadge.style.display="block";
 }else{
  cartBadge.style.display="none";
 }
}

function updateCartDisplay(){
 const checkoutBtn=document.getElementById("checkout");

 if(cart.length===0){
  cartItems.innerHTML="";
  emptyCart.style.display="block";
  cartTotal.style.display="none";
  checkoutBtn.disabled=true;
  itemCount.textContent="";
  return;
 }

 const totalItems=cart.reduce((sum,item)=>sum+item.qty,0);
 itemCount.textContent=`${totalItems} item${totalItems>1?'s':''}`;

 emptyCart.style.display="none";
 cartTotal.style.display="flex";
 checkoutBtn.disabled=false;

 cartItems.innerHTML=cart.map((item,idx)=>`<div class="cart-item">
   <div class="cart-item-info">
    <div class="cart-item-name">${item.name}</div>
    <div class="cart-item-price">‚Çπ${item.price} each</div>
   </div>
   <div class="cart-item-controls">
    <button class="qty-btn" onclick="changeQty(${idx},-1)">‚àí</button>
    <span class="qty">${item.qty}</span>
    <button class="qty-btn" onclick="changeQty(${idx},1)">+</button>
   </div>
  </div>`).join("");

 const total=cart.reduce((sum,item)=>sum+(item.price*item.qty),0);
 totalPrice.textContent=`‚Çπ${total}`;
}

function changeQty(idx,delta){
 if(!cart[idx]) return;
 cart[idx].qty+=delta;
 if(cart[idx].qty<=0){
  cart.splice(idx,1);
 }
 updateCartBadge();
 updateCartDisplay();
}

function updateRotateBtn(){
 const btn=document.getElementById("toggleRotate");
 if(autoRotate){
  btn.classList.add("active");
 }else{
  btn.classList.remove("active");
 }
}

function updateFavoritesDisplay(){
 if(favorites.length===0){
  favoritesItems.innerHTML="";
  emptyFavorites.style.display="block";
  return;
 }
 
 emptyFavorites.style.display="none";
 favoritesItems.innerHTML=favorites.map((name,idx)=>{
  const food=foods.find(f=>f.name===name);
  return`<div class="favorite-item">
   <div class="favorite-item-info">
    <div class="favorite-item-name">${food.name}</div>
    <div class="favorite-item-price">‚Çπ${food.price}</div>
   </div>
   <div class="favorite-item-actions">
    <button class="fav-action-btn add" onclick="addToCartFromFavorites('${food.name}')">üõí</button>
    <button class="fav-action-btn" onclick="removeFromFavorites(${idx})">üóëÔ∏è</button>
   </div>
  </div>`;
 }).join("");
}

function updateCompareDisplay(){
 if(compareList.length===0){
  compareItems.innerHTML="";
  emptyCompare.style.display="block";
  return;
 }
 
 emptyCompare.style.display="none";
 compareItems.innerHTML=`<div class="compare-grid">${compareList.map((name,idx)=>{
  const food=foods.find(f=>f.name===name);
  return`<div class="compare-item">
   <div class="compare-item-name">${food.name}</div>
   <div class="compare-item-price">‚Çπ${food.price}</div>
   <div class="compare-item-rating">‚≠ê ${food.rating}</div>
   <div class="compare-item-stats">${food.views} views ‚Ä¢ ${food.orders} orders</div>
   <button class="compare-remove-btn" onclick="removeFromCompare(${idx})">Remove</button>
  </div>`;
 }).join('')}</div>`;
}

function updateRecentlyViewed(){
 const container = document.getElementById("recentlyViewed");
 if(recentlyViewedList.length === 0){
  container.innerHTML = "";
  return;
 }
 
 container.innerHTML = recentlyViewedList.slice(-5).map((name, idx) => {
  const food = foods.find(f => f.name === name);
  const isActive = foods[index].name === name;
  return `<div class="recent-item ${isActive ? 'active' : ''}" onclick="jumpToFood('${name}')" title="${food.name}">üçΩÔ∏è</div>`;
 }).join("");
}

function jumpToFood(name){
 const idx = foods.findIndex(f => f.name === name);
 if(idx !== -1){
  index = idx;
  showFood(index);
 }
}

function addToCartFromFavorites(name){
 const food=foods.find(f=>f.name===name);
 const existing=cart.find(item=>item.name===food.name);
 if(existing){
  existing.qty++;
 }else{
  cart.push({name:food.name,price:food.price,qty:1});
 }
 updateCartBadge();
 showToast(`${food.name} added to cart! üõí`);
}

function removeFromFavorites(idx){
 favorites.splice(idx,1);
 updateFavoritesDisplay();
 showToast("Removed from favorites");
}

function removeFromCompare(idx){
 compareList.splice(idx,1);
 updateCompareDisplay();
 showToast("Removed from comparison");
}

function addToRecentlyViewed(name){
 if(!recentlyViewedList.includes(name)){
  recentlyViewedList.push(name);
  if(recentlyViewedList.length > 5){
   recentlyViewedList.shift();
  }
  updateRecentlyViewed();
 }
}

function showNutrition(){
 const food = foods[index];
 document.getElementById("calories").textContent = food.calories;
 document.getElementById("protein").textContent = food.protein + "g";
 document.getElementById("carbs").textContent = food.carbs + "g";
 document.getElementById("fat").textContent = food.fat + "g";
 
 const maxCalories = 500;
 const maxProtein = 50;
 const maxCarbs = 100;
 const maxFat = 50;
 
 document.querySelectorAll(".nutrition-bar-fill")[0].style.width = Math.min((food.calories/maxCalories)*100, 100) + "%";
 document.querySelectorAll(".nutrition-bar-fill")[1].style.width = Math.min((food.protein/maxProtein)*100, 100) + "%";
 document.querySelectorAll(".nutrition-bar-fill")[2].style.width = Math.min((food.carbs/maxCarbs)*100, 100) + "%";
 document.querySelectorAll(".nutrition-bar-fill")[3].style.width = Math.min((food.fat/maxFat)*100, 100) + "%";
 
 nutritionModal.style.display = "flex";
}

function toggleDarkMode(){
 isDarkMode = !isDarkMode;
 document.body.classList.toggle("light-mode");
 document.getElementById("darkModeToggle").textContent = isDarkMode ? "üåô" : "‚òÄÔ∏è";
 showToast(isDarkMode ? "Dark mode enabled üåô" : "Light mode enabled ‚òÄÔ∏è");
}

function startVoiceSearch(){
 if(!('webkitSpeechRecognition' in window)){
  showToast("Voice search not supported");
  return;
 }
 
 if(isListening){
  recognition.stop();
  return;
 }
 
 const recognition = new webkitSpeechRecognition();
 recognition.lang = 'en-US';
 recognition.continuous = false;
 recognition.interimResults = false;
 
 recognition.onstart = () => {
  isListening = true;
  voiceBtn.classList.add("listening");
  showToast("Listening... üé§");
 };
 
 recognition.onend = () => {
  isListening = false;
  voiceBtn.classList.remove("listening");
 };
 
 recognition.onresult = (event) => {
  const transcript = event.results[0][0].transcript.toLowerCase();
  showToast(`You said: "${transcript}"`);
  
  const matches = foods.filter(f => f.name.toLowerCase().includes(transcript) || 
                                   f.category.toLowerCase().includes(transcript));
  
  if(matches.length > 0){
   displaySearchResults(matches);
  }else{
   showToast("No matches found");
  }
 };
 
 recognition.start();
}

function displaySearchResults(matches){
 searchResults.innerHTML = matches.map(food => `
  <div class="search-result-item" onclick="selectSearchResult('${food.name}')">
   <div class="search-result-icon">üçΩÔ∏è</div>
   <div class="search-result-info">
    <div class="search-result-name">${food.name}</div>
    <div class="search-result-price">‚Çπ${food.price}</div>
   </div>
  </div>
 `).join("");
 searchResults.classList.add("show");
}

function selectSearchResult(name){
 const idx = foods.findIndex(f => f.name === name);
 if(idx !== -1){
  index = idx;
  showFood(index);
  searchResults.classList.remove("show");
 }
}

/* ---------- Preload all models ---------- */
foods.forEach((food,i)=>{
 const m=document.createElement("a-entity");
 m.setAttribute("gltf-model",food.model);
 m.object3D.scale.set(food.scale,food.scale,food.scale);
 m.object3D.visible=false;
 holder.appendChild(m);
 models.push(m);

 m.addEventListener("model-loaded",()=>{
  loadedCount++;
  const progress=(loadedCount/foods.length)*100;
  loadingProgress.style.width=progress+"%";
  loadingText.textContent=`Loading models‚Ä¶ ${loadedCount}/${foods.length}`;
  if(loadedCount===foods.length){
   setTimeout(()=>{
    loading.style.display="none";
    showFood(0);
    showToast("Welcome to FoodAR! üëã");
    setTimeout(() => {
     gestureHint.classList.add("show");
     setTimeout(() => gestureHint.classList.remove("show"), 4000);
    }, 1000);
   },300);
  }
 });
});

/* ---------- Show ---------- */
function showFood(i){
 models.forEach((m,idx)=>{
  m.object3D.visible=(idx===i);
 });
 scale=foods[i].scale;
 models[i].object3D.scale.set(scale,scale,scale);
 yaw=pitch=0;
 models[i].object3D.rotation.set(0,0,0);

 const food=foods[i];
 foodName.textContent=food.name;
 foodPrice.textContent=`‚Çπ${food.price}`;
 viewCount.textContent=food.views;
 avgRating.textContent=food.rating.toFixed(1);
 orderCount.textContent=food.orders;

 rating=0;
 updateStars();
 autoRotate=true;
 updateRotateBtn();
 
 addToRecentlyViewed(food.name);
 updateRecentlyViewed();
 
 foods[i].views++;
 viewCount.textContent = foods[i].views;
}

function resetView(){
 if(!models[index]) return;
 scale=foods[index].scale;
 models[index].object3D.scale.set(scale,scale,scale);
 yaw=pitch=0;
 models[index].object3D.rotation.set(0,0,0);
 autoRotate=true;
 updateRotateBtn();
 showToast("View reset üîÑ");
}

function toggleAutoRotate(){
 autoRotate=!autoRotate;
 updateRotateBtn();
 showToast(autoRotate?"Auto-rotate ON ‚Üª":"Auto-rotate OFF");
}

/* ---------- UI ---------- */
document.getElementById("left").onclick=()=>{  index=(index+foods.length-1)%foods.length;  showFood(index); };
document.getElementById("right").onclick=()=>{ index=(index+1)%foods.length; showFood(index); };
document.getElementById("resetBtn").onclick=resetView;
document.getElementById("toggleRotate").onclick=toggleAutoRotate;

document.getElementById("shareBtn").onclick=()=>{
 const food=foods[index];
 if(navigator.share){
  navigator.share({
   title: `Check out ${food.name} on FoodAR!`,
   text: `Delicious ${food.name} for just ‚Çπ${food.price}`,
   url: window.location.href
  });
 }else{
  showToast(`Sharing ${food.name}... üì§`);
 }
};

document.getElementById("filterBtn").onclick=()=>{
 filterMenu.classList.toggle("show");
 searchResults.classList.remove("show");
};

document.getElementById("viewCart").onclick=()=>{
 updateCartDisplay();
 cartModal.style.display="flex";
};

document.getElementById("closeCart").onclick=()=>{
 cartModal.style.display="none";
};

document.getElementById("checkout").onclick=()=>{
 if(cart.length===0){
  showToast("Cart is empty!");
  return;
 }
 const total=cart.reduce((sum,item)=>sum+(item.price*item.qty),0);
 showToast(`Order placed: ‚Çπ${total} ‚úÖ`);
 cart=[];
 updateCartBadge();
 updateCartDisplay();
 foods.forEach(f => {
  cart.forEach(item => {
   if(f.name === item.name) f.orders += item.qty;
  });
 });
 setTimeout(()=>{
  cartModal.style.display="none";
 },1000);
};

document.getElementById("addCart").onclick=()=>{
 quantitySelector.classList.add("show");
};

document.getElementById("qtyMinus").onclick = () => {
 if(currentQty > 1){
  currentQty--;
  qtyDisplay.textContent = currentQty;
 }
};

document.getElementById("qtyPlus").onclick = () => {
 if(currentQty < 10){
  currentQty++;
  qtyDisplay.textContent = currentQty;
 }
};

quantitySelector.addEventListener("click", (e) => {
 if(e.target === quantitySelector){
  const food=foods[index];
  const existing=cart.find(item=>item.name===food.name);

  if(existing){
   existing.qty += currentQty;
  }else{
   cart.push({name:food.name,price:food.price,qty:currentQty});
  }

  updateCartBadge();
  showToast(`${currentQty}x ${food.name} added! üõí`);
  quantitySelector.classList.remove("show");
  currentQty = 1;
  qtyDisplay.textContent = currentQty;
 }
});

cartModal.onclick=(e)=>{
 if(e.target===cartModal){
  cartModal.style.display="none";
 }
};

document.querySelectorAll('[data-filter]').forEach(chip=>{
 chip.onclick=()=>{
  document.querySelectorAll('[data-filter]').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  currentFilter=chip.dataset.filter;
  showToast(`Filter: ${chip.textContent}`);
 };
});

document.querySelectorAll('[data-category]').forEach(chip=>{
 chip.onclick=()=>{
  document.querySelectorAll('[data-category]').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  currentCategory=chip.dataset.category;
  showToast(`Category: ${chip.textContent}`);
 };
});

fab.addEventListener("click", (e) => {
  e.stopPropagation();
  if (fabMenu.classList.contains("show")) {
    fabMenu.classList.remove("show");
    fab.classList.remove("active");
  } else {
    fabMenu.classList.add("show");
    fab.classList.add("active");
    clearTimeout(fabTimeout);
    fabTimeout = setTimeout(() => {
      fabMenu.classList.remove("show");
      fab.classList.remove("active");
    }, 3000);
  }
});

fabMenu.addEventListener("click", (e) => {
  e.stopPropagation();
});

document.addEventListener("click", () => {
  fabMenu.classList.remove("show");
  fab.classList.remove("active");
  searchResults.classList.remove("show");
});

document.getElementById("favoriteFab").onclick=()=>{
 const foodName=foods[index].name;
 const idx=favorites.indexOf(foodName);
 if(idx>-1){
  favorites.splice(idx,1);
  showToast("Removed from favorites");
 }else{
  favorites.push(foodName);
  showToast("Added to favorites ‚ù§Ô∏è");
 }
};

document.getElementById("rateFab").onclick=()=>{
 ratingMenu.classList.add("show");
};

document.getElementById("compareFab").onclick=()=>{
 const foodName=foods[index].name;
 const idx=compareList.indexOf(foodName);
 if(idx>-1){
  compareList.splice(idx,1);
  showToast("Removed from comparison");
 }else{
  if(compareList.length>=3){
   showToast("Max 3 items for comparison");
   return;
  }
  compareList.push(foodName);
  showToast(`Added to compare (${compareList.length}/3)`);
 }
};

document.getElementById("viewFavoritesFab").onclick=()=>{
 updateFavoritesDisplay();
 favoritesModal.style.display="flex";
};

document.getElementById("closeFavorites").onclick=()=>{
 favoritesModal.style.display="none";
};

favoritesModal.onclick=(e)=>{
 if(e.target===favoritesModal){
  favoritesModal.style.display="none";
 }
};

document.getElementById("closeCompare").onclick=()=>{
 compareModal.style.display="none";
};

document.getElementById("closeCompareBtn").onclick=()=>{
 compareModal.style.display="none";
};

document.getElementById("clearCompare").onclick=()=>{
 compareList = [];
 updateCompareDisplay();
 showToast("Comparison cleared");
};

compareModal.onclick=(e)=>{
 if(e.target===compareModal){
  compareModal.style.display="none";
 }
};

document.querySelectorAll(".star").forEach(s=>{
 s.onclick=()=>{
  const currentRating=parseInt(s.dataset.s);
  rating=currentRating;
  updateStars();
  foods[index].rating = ((foods[index].rating * foods[index].views) + rating) / (foods[index].views + 1);
  avgRating.textContent = foods[index].rating.toFixed(1);
  showToast(`Rated ${rating} ‚òÖ`);
  setTimeout(()=>{
   ratingMenu.classList.remove("show");
  },1200);
 };
});

document.getElementById("nutritionBtn").onclick = showNutrition;
document.getElementById("closeNutrition").onclick = () => nutritionModal.style.display = "none";
document.getElementById("closeNutritionBtn").onclick = () => nutritionModal.style.display = "none";
nutritionModal.onclick = (e) => { if(e.target === nutritionModal) nutritionModal.style.display = "none"; };

document.getElementById("darkModeToggle").onclick = toggleDarkMode;
voiceBtn.onclick = startVoiceSearch;

document.getElementById("arBtn").onclick = () => {
 arInstructions.classList.add("show");
};

document.getElementById("startAR").onclick = () => {
 arInstructions.classList.remove("show");
 showToast("AR mode activated üì±");
};

/* ---------- Input (Touch + Mouse) ---------- */
let dragging=false,lx=0,ly=0,zoom=0;

function dist(a,b){
 const dx=a.clientX-b.clientX;
 const dy=a.clientY-b.clientY;
 return Math.sqrt(dx*dx+dy*dy);
}

function start(x,y,e){
 if(e && e.target && (
  e.target.classList.contains('nav-btn') ||
  e.target.classList.contains('action-btn') ||
  e.target.classList.contains('quick-btn') ||
  e.target.classList.contains('top-btn') ||
  e.target.classList.contains('star') ||
  e.target.id==='viewCart' ||
  e.target.closest('#cartModal') ||
  e.target.closest('#filterMenu') ||
  e.target.closest('#fab') ||
  e.target.closest('#fabMenu') ||
  e.target.closest('#quantitySelector') ||
  e.target.closest('#favoritesModal') ||
  e.target.closest('#compareModal') ||
  e.target.closest('#nutritionModal') ||
  e.target.closest('#arInstructions')
 )) return;

 dragging=true; lx=x; ly=y; autoRotate=false;
 updateRotateBtn();
}

function move(x,y){
 if(!models[index]) return;
 yaw+=(x-lx)*0.01;
 pitch+=(y-ly)*0.01;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lx=x; ly=y;
 models[index].object3D.rotation.set(pitch,yaw,0);
}

function end(){
 dragging=false;
 setTimeout(()=>{
  autoRotate=true;
  updateRotateBtn();
 },2000);
}

document.addEventListener("touchstart",e=>{
 if(e.touches.length===1) start(e.touches[0].clientX,e.touches[0].clientY,e);
 if(e.touches.length===2) zoom=dist(e.touches[0],e.touches[1]);
});

document.addEventListener("touchmove",e=>{
 if(e.touches.length===2){
  const d=dist(e.touches[0],e.touches[1]);
  if(models[index]){
   scale*=d/zoom;
   models[index].object3D.scale.set(scale,scale,scale);
  }
  zoom=d;
 }
 if(dragging && e.touches.length===1)
  move(e.touches[0].clientX,e.touches[0].clientY);
});

document.addEventListener("touchend",end);

document.addEventListener("mousedown",e=>start(e.clientX,e.clientY,e));
document.addEventListener("mousemove",e=>dragging&&move(e.clientX,e.clientY));
document.addEventListener("mouseup",end);

document.addEventListener("wheel",e=>{
 if(e.target.classList.contains('nav-btn') ||
    e.target.classList.contains('action-btn') ||
    e.target.classList.contains('quick-btn') ||
    e.target.classList.contains('top-btn') ||
    e.target.id==='viewCart' ||
    e.target.closest('#cartModal') ||
    e.target.closest('#filterMenu') ||
    e.target.closest('#fab') ||
    e.target.closest('#fabMenu') ||
    e.target.closest('#quantitySelector')) return;

 if(!models[index]) return;

 scale+=e.deltaY*-0.001;
 models[index].object3D.scale.set(scale,scale,scale);
});

AFRAME.registerComponent("spin",{
 tick:function(){
  if(autoRotate && models[index]){
   yaw+=0.002;
   models[index].object3D.rotation.y=yaw;
  }
 }
});
holder.setAttribute("spin","");
</script>

</body>
</html>
